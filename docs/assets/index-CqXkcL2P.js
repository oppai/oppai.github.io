import{S as be,P as De,W as Me,A as xe,D as Pe,O as Ae,a as k,M as Y,b as C,c as v,B as ve,C as Se,F as K,d as Te,e as Ee,f as ke,g as ie,V as F,h as Ie,R as re,T as se,i as ze,j as Ye,k as Ce}from"./vendor-three-DGfO6NI1.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))c(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const m of r.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function D(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function c(o){if(o.ep)return;o.ep=!0;const r=D(o);fetch(o.href,r)}})();const H=new be,L=new De(75,window.innerWidth/window.innerHeight,.1,1e3),O=new Me({antialias:!0});O.setSize(window.innerWidth,window.innerHeight);O.setClearColor(0);L.position.z=7;const Oe=new xe(16777215,1.5);H.add(Oe);const ue=new Pe(16777215,.5);ue.position.set(5,10,7.5);H.add(ue);const R=new Ae(L,O.domElement);R.enableDamping=!0;R.dampingFactor=.05;R.screenSpacePanning=!1;R.minDistance=3;R.maxDistance=20;R.maxPolarAngle=Math.PI/2;function Re(){L.aspect=window.innerWidth/window.innerHeight,L.updateProjectionMatrix(),O.setSize(window.innerWidth,window.innerHeight)}window.addEventListener("resize",Re,!1);function Ge(a){const n=document.getElementById(a);n?n.appendChild(O.domElement):console.error(`Container with id '${a}' not found.`)}let M,g;const Q=[],pe=[];let B;const ee=[];async function We(a,n){const D=[n.loadAsync("/assets/kodam.avif"),n.loadAsync("/assets/gohst.avif"),n.loadAsync("/assets/effect.avif"),n.loadAsync("/assets/cards.avif"),n.loadAsync("/assets/ground.avif"),n.loadAsync("/assets/ground-none.avif"),n.loadAsync("/assets/wall.avif")];let c,o,r,m,j,N,x;try{[c,o,r,m,j,N,x]=await Promise.all(D)}catch(t){console.error("An error happened during parallel texture loading:",t)}try{if(c){const t=c.image.width/c.image.height,s=5,l=s*t,d=new k(l,s),h=new Y({map:c,side:C,transparent:!0,depthWrite:!1,alphaTest:.1});M=new v(d,h),M.userData.initialY=M.position.y,M.userData.time=0,M.renderOrder=2,a.add(M);const u=500,f=.03,p=new ve,i=[],y=[],I=[],b=new Se(11184895);for(let ne=0;ne<u;ne++){const X=1.8+Math.pow(Math.random(),3)*1,oe=Math.random()*Math.PI*2,Z=Math.acos(Math.random()*2-1),ge=X*Math.sin(Z)*Math.cos(oe),we=X*Math.sin(Z)*Math.sin(oe),ye=X*Math.cos(Z)-.2;i.push(ge,we,ye);const _=Math.random()*.3;y.push(b.r+_,b.g+_,b.b+_,1),I.push((Math.random()-.5)*.02,(Math.random()-.5)*.02,Math.random()*Math.PI*2)}p.setAttribute("position",new K(i,3)),p.setAttribute("color",new K(y,4)),p.setAttribute("velocity",new K(I,3));const me=new Te({size:f,sizeAttenuation:!0,vertexColors:!0,transparent:!0,blending:Ee,depthWrite:!1});B=new ke(p,me),B.userData.initialPositions=p.attributes.position.clone(),B.renderOrder=1,a.add(B)}else throw new Error("Kodam texture failed to load.")}catch(t){console.error("An error happened setting up the kodam object or aura:",t);const s=new k(5,5),l=new ie({color:16711680});M=new v(s,l),M.userData.initialY=M.position.y,M.userData.time=0,M.renderOrder=2,a.add(M)}try{if(o){const t=o.image.width/o.image.height,s=2,l=s*t,d=new k(l,s),h=new Y({map:o,side:C,transparent:!0,depthWrite:!1,alphaTest:.1});g=new v(d,h),g.position.z=-.1,g.position.x=g.position.x-1.2,g.userData.initialY=g.position.y+2,g.userData.time=Math.PI,g.renderOrder=0,a.add(g)}else throw new Error("Gohst texture failed to load.")}catch(t){console.error("An error happened setting up the gohst object:",t);const s=new k(4,4),l=new ie({color:255});g=new v(s,l),g.position.z=-.1,a.add(g)}try{if(r){const t=r.image.width/r.image.height,s=3,l=s*t,d=new k(l,s),h=new Y({map:r,side:C,transparent:!0,depthWrite:!1,alphaTest:.1,opacity:.7}),u=new v(d,h.clone()),f=new v(d,h.clone()),p=g?g.position.clone():new F(0,0,-.2);p.x-=.7,p.y+=1,p.z-=.1,u.position.copy(p),f.position.copy(p),f.position.x+=4,u.rotation.z=Math.PI/4,f.rotation.z=-Math.PI/4,[u,f].forEach((i,y)=>{i.userData.initialY=i.position.y,i.userData.time=Math.random()*Math.PI*2,i.userData.speed=.015+Math.random()*.01,i.userData.amplitude=.15+Math.random()*.05,i.renderOrder=-1,a.add(i),pe.push(i)})}else throw new Error("Effect texture failed to load.")}catch(t){console.error("An error happened setting up the effect objects:",t)}try{if(m){const l=[new F(-2,-.4,.1),new F(2,-.4,.1),new F(-1.5,-.7,.1),new F(1.5,-.7,.1)],d=[{x:0,y:.5},{x:.65/2+.02,y:.5},{x:0,y:0},{x:.65/2+.02,y:0}];for(let h=0;h<4;h++){const u=m.clone();u.needsUpdate=!0,u.repeat.set(.5*.65,.5),u.offset.set(d[h].x,d[h].y);const f=new k(1*.65,1),p=new Y({map:u,side:C,transparent:!0,depthWrite:!1,alphaTest:.1}),i=new v(f,p);i.position.copy(l[h]),i.userData.initialY=i.position.y,i.userData.initialZ=i.position.z,i.userData.time=Math.random()*Math.PI*2,i.userData.speed=.01+Math.random()*.02,i.userData.amplitude=.1+Math.random()*.05,i.renderOrder=3,a.add(i),Q.push(i)}}else throw new Error("Cards texture failed to load.")}catch(t){console.error("An error happened setting up the card objects:",t)}try{if(j&&N){const t=document.createElement("canvas"),s=t.getContext("2d"),l=1024;t.width=l,t.height=l;const d=j.image,h=N.image;if(d&&h){s.fillStyle=s.createPattern(h,"repeat"),s.fillRect(0,0,t.width,t.height);const y=l/8,I=(l-y)/2,b=(l-y)/2;s.drawImage(d,I,b,y,y)}else{console.error("Background images not loaded for canvas drawing."),s.fillStyle="grey",s.fillRect(0,0,t.width,t.height),s.fillStyle="darkgrey";const y=l/4,I=(l-y)/2,b=(l-y)/2;s.fillRect(I,b,y,y)}const u=new Ie(t);u.needsUpdate=!0;const f=new k(50,50),p=new Y({map:u,side:C}),i=new v(f,p);i.rotation.x=-Math.PI/2,i.position.y=-2.5,i.renderOrder=-3,a.add(i)}else throw new Error("Background textures failed to load.")}catch(t){console.error("An error happened creating the ground canvas texture:",t)}try{if(x){x.wrapS=re,x.wrapT=re;const t=5;x.repeat.set(t,t);const s=new k(50,50),l=new Y({map:x,side:C}),d=new v(s,l);d.position.y=7.5,d.position.z=-10,d.renderOrder=-4,a.add(d)}else throw new Error("Wall texture failed to load.")}catch(t){console.error("An error happened creating the wall object:",t)}const P=1,z=1,e=3,w=[{name:"x",file:"/assets/x.avif",url:"https://x.com/kodam"},{name:"github",file:"/assets/github.avif",url:"https://github.com/oppai"},{name:"cv",file:"/assets/cv.avif",url:"https://gist.github.com/oppai/5e10c6bd03c9d53f50564a369be2f940"}],T=[{name:"ai",file:"/assets/ai.avif",url:"https://note.com/0ppai"},{name:"poker",file:"/assets/poker.avif",url:"https://note.com/brianpoker"}];async function G(t,s,l=0){const d=-(t.length-1)*z/2,h=t.map(u=>n.loadAsync(u.file).catch(f=>(console.error(`Failed to load texture ${u.file}:`,f),null)));try{const u=await Promise.all(h);for(let f=0;f<t.length;f++){const p=t[f],i=u[f];if(!i){console.warn(`Skipping link plane for ${p.name} due to texture load failure.`);continue}const y=new k(P,P),I=new Y({map:i,side:C,transparent:!0,depthWrite:!1,alphaTest:.1}),b=new v(y,I);b.position.x=d+f*z,b.position.y=s,b.position.z=e,b.userData={type:"link",name:p.name,url:p.url,initialY:s,initialZ:e},b.renderOrder=4+l,a.add(b),ee.push(b)}}catch(u){console.error(`An error happened creating link row at y=${s}:`,u)}}await G(w,-2,0),await G(T,2.5,1)}let W;async function Le(a){try{const n=await fetch("./assets/nebulaConfig.json");if(!n.ok)throw new Error(`HTTP error! status: ${n.status}`);const D=await n.json();W=await Nebula.System.fromJSONAsync(D,se);const c=new Nebula.SpriteRenderer(a,se);W=W.addRenderer(c),c.target?(c.target.renderOrder=-2,c.target.material?(c.target.material.depthWrite=!1,c.target.material.depthTest=!1):console.warn("Could not find Nebula renderer target material to set depthWrite/depthTest.")):console.warn("Could not find Nebula renderer target to set renderOrder/depthWrite/depthTest."),W.updateEmitterPosition=(o,r)=>{if(r&&o){const m=r.position.clone();m.y-=1,o.position.copy(m),o.position.z-=.5}}}catch(n){console.error("Error loading or setting up Nebula system:",n),W=null}return W}let te=null;const U=3;let S=U,J=0;const ce=.2,je=.04;let $="JIGGLING",V=0;const Ne=60;function fe(a){const{scene:n,camera:D,renderer:c,controls:o,planeKodam:r,planeGohst:m,cardMeshes:j,effectMeshes:N,auraParticles:x,linkMeshes:P,nebulaSystem:z}=a;if(te=requestAnimationFrame(()=>fe(a)),r&&(r.userData.time+=.02,r.position.y=r.userData.initialY+Math.sin(r.userData.time)*.2),m&&(m.userData.time+=.025,m.position.y=m.userData.initialY+Math.sin(m.userData.time)*.4),j.forEach(e=>{e.userData.time+=e.userData.speed,e.position.y=e.userData.initialY+Math.sin(e.userData.time)*e.userData.amplitude}),N.forEach(e=>{e.userData.time+=e.userData.speed,e.position.y=e.userData.initialY+Math.sin(e.userData.time)*e.userData.amplitude}),P&&P.length>0)if($==="JIGGLING"){J+=1;const e=P[S];if(e&&e.userData&&typeof e.userData.initialY<"u"){const w=Math.sin(J*ce)*je;e.position.y=e.userData.initialY+w}else e&&console.warn(`Missing userData or initialY for active link index ${S}`);if(P.forEach((w,T)=>{T!==S&&w.userData&&typeof w.userData.initialY<"u"&&w.position.y!==w.userData.initialY&&(w.position.y=w.userData.initialY)}),J*ce>=Math.PI*2){e&&e.userData&&(e.position.y=e.userData.initialY),J=0;const w=S>=U,T=S===P.length-1,G=S===U-1;w?T?S=0:S++:G?($="PAUSED",V=0,P.forEach(E=>{E&&E.userData&&(E.position.y=E.userData.initialY)})):S++}}else $==="PAUSED"&&(V++,P.forEach(e=>{e&&e.userData&&e.position.y!==e.userData.initialY&&(e.position.y=e.userData.initialY)}),V>=Ne&&($="JIGGLING",S=U));if(z&&r){const e=z.emitters[0];e&&z.updateEmitterPosition(e,r),z.update()}if(x&&r){x.position.copy(r.position);const e=x.geometry.attributes.position,w=x.geometry.attributes.color,T=x.userData.initialPositions,G=x.geometry.attributes.velocity,E=Date.now()*.0015;for(let A=0;A<e.count;A++){const t=T.getX(A),s=T.getY(A);T.getZ(A);const l=G.getZ(A);e.setX(A,t+Math.sin(E*1.5+l)*.12),e.setY(A,s+Math.cos(E*1.5+l)*.12);const d=Math.abs(Math.sin(E*2+l));w.setW(A,d)}e.needsUpdate=!0,w.needsUpdate=!0}o.update(),c.render(n,D)}function Fe(a){te&&cancelAnimationFrame(te),fe(a)}const le=new ze,q=new Ye;let he,ae=[];function de(a){const n=a.target.getBoundingClientRect();q.x=(a.clientX-n.left)/n.width*2-1,q.y=-((a.clientY-n.top)/n.height)*2+1,le.setFromCamera(q,he);const D=le.intersectObjects(ae,!0);if(D.length>0){let c=null;for(const o of D)if(o.object.userData&&o.object.userData.url){c=o.object;break}c&&c.userData&&c.userData.url&&(console.log(`Clicked on ${c.userData.name||"object"}, navigating to: ${c.userData.url}`),window.open(c.userData.url,"_blank"))}}function Be(a,n,D){he=n,ae=D,a.domElement.removeEventListener("click",de,!1),a.domElement.addEventListener("click",de,!1),console.log("Raycaster initialized. Clickable objects:",ae.map(c=>c.userData.name||"Unnamed"))}async function He(){Ge("canvas-container");const a=new Ce;await We(H,a);const n=await Le(H),D=[M,g,...Q,...ee];Be(O,L,D),Fe({scene:H,camera:L,renderer:O,controls:R,planeKodam:M,planeGohst:g,cardMeshes:Q,effectMeshes:pe,auraParticles:B,linkMeshes:ee,nebulaSystem:n})}He().catch(a=>{console.error("Initialization failed:",a)});
